;Составить подпрограмму с именем Count типа
;      function (const S: LONGWORD; L:LONGWORD):INTEGER;
;возвращающую число единиц битовой строки S длины L.
.386
.model FLAT,C
PUBLIC COUNT

.CODE
COUNT:

					; по соглашениям
	PUSH EBP		; сохранение значение предыдущей функции 
	MOV EBP,ESP		; записываем текущую позицию в стеке 
	PUSH EBX		; сохраняем прежние

	
	XOR EAX,EAX		  ; обнуление EAX( счетчик единиц)
	MOV EBX,[EBP+8]   ; Заносим адрес строки S, со смещение 12 (начало слова)
	MOV	ECX,[EBP+12]  ; Длина строки
	
	MOV	EDX,0         ; Адресация по битам (хвост слова)
	
	CC:
		BT [EBX],EDX ; Проверка бита строки с индексом EDX [0..31], Флаг CF 
		JNC NO		 ; Просткакиваем увеличение счетчика
		INC EAX		 ; Увеличиваем счетчик на 1
	NO:	
		INC EDX		 ; сдвиг индекса
		CMP EDX,32	 ; Проверка на конец слова
		JNE NEQ		 ; Перескок на начало цикла если не конец слова
		
					 ; Если конец слова
		MOV	EDX,0	 ; Обнуляем индексатор
		ADD EBX,4	 ; Двигаемся на следущее слово
	NEQ:
	LOOP CC			 
	
	; выход из функции по правилам паскаля
	
	POP EBX
	MOV ESP,EBP
	POP EBP
	RET 
END
